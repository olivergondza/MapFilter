<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <title>MapFilter: MapFilter</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
    <script type="text/javaScript" src="search/search.js"></script>
    <link href="style.css" rel="stylesheet" type="text/css"/>
  </head>
  <body onload='searchBox.OnSelectItem(0);'>
  
    <div id="container">
    
      <div id="header">
      
        <h1><a href="http://github.com/olivergondza/MapFilter">MapFilter</a></h1>
        
        <div class="left">
          <pre>$ git clone git://github.com/olivergondza/MapFilter</pre>
        </div>
        
        <div class="right">
          <pre>Source: <a href="http://github.com/olivergondza/MapFilter/zipball/master"><strong>zip</strong></a
          > | <a href="http://github.com/olivergondza/MapFilter/tarball/master"><strong>tar</strong></a
          > | <a href="http://github.com/olivergondza/MapFilter"><strong>git</strong></a></pre>
        </div>
        
      </div>

      <div class="navigation">
        <div class="tabs">  
          <ul class="tablist">
            <li><a href="../../user/html/index.html"><span>user</span></a></li>
            <li class="current"><a href="../../programmer/html/index.html"><span>programmer</span></a></li>
            <li><a href="../../internal/html/index.html"><span>internal</span></a></li>
          </ul>
        </div>
<!-- Generated by Doxygen 1.8.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="index.html">MapFilter</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title"><a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> Usage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="mapfilter"></a>
MapFilter</h2>
<p><a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> is a tool designed to create filters that process user <code>queries</code> to one or more <code>results</code> according to defined <code>pattern</code>.</p>
<ul>
<li>A <code>pattern</code> is an arbitrary implementation of <code><a class="el" href="interfaceMapFilter__PatternInterface.html" title="MapFilter_Pattern Interface.">MapFilter_PatternInterface</a></code>. The pattern is used during the parsing procedure to do all the work needed to obtain all kinds of results specified by implemented interfaces.</li>
</ul>
<ul>
<li>A <code>query</code> is a data structure (usually obtained from the user) to be filtered by the pattern. <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> itself does not constrain the type of user query. However, it might be constraint by the pattern.</li>
</ul>
<ul>
<li><code>Results</code> are the outcomes of user query filtering. Every pattern should provide one or more results.</li>
</ul>
<p>To use <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> there is need to define the pattern (and inject it using constructor or <a class="el" href="classMapFilter_a4ff9ed7eb8cf66a34e87ad71a5f9ba45.html#a4ff9ed7eb8cf66a34e87ad71a5f9ba45">setPattern</a> method) describing expected data. After setting the query (using constructor or <a class="el" href="classMapFilter_a687f75a5e4e1c2616cade595658c3756.html#a687f75a5e4e1c2616cade595658c3756">setQuery</a> method), <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> is ready to proceed with input filtering. Filtering results are obtained by <a class="el" href="classMapFilter_adc683e17988ab8f300062dd060b42fad.html#adc683e17988ab8f300062dd060b42fad">fetchResult</a>. The result is the value returned by the <code><a class="el" href="interfaceMapFilter__PatternInterface_a95c938dfe1bb06693b7d628198c74d89.html#a95c938dfe1bb06693b7d628198c74d89" title="Parse the given query against the pattern.">MapFilter_PatternInterface::parse()</a></code> method or the pattern instance itself in case the method returned <code>null</code>.</p>
<h2><a class="anchor" id="examples"></a>
Examples</h2>
<h3><a class="anchor" id="examplesmapfilter"></a>
MapFilter</h3>
<p>There are three different ways how to create <code><a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a></code> instance:</p>
<div class="fragment"><pre class="fragment">
    $pattern = <span class="keyword">new</span> <a class="code" href="classMapFilter__NullPattern.html" title="A mock implementation of basic MapFilter_PatternInterface interface.">MapFilter_NullPattern</a> ();

    $query = Array ( <span class="stringliteral">&#39;attr0&#39;</span> =&gt; <span class="stringliteral">&#39;value&#39;</span>, <span class="stringliteral">&#39;attr1&#39;</span> =&gt; <span class="stringliteral">&#39;value&#39;</span> );

    <span class="comment">// Configure filter using constructor.</span>
    $filter0 = <span class="keyword">new</span> <a class="code" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> ( $pattern, $query );

    <span class="comment">// Create empty filter and configure it using fluent interface.</span>
    $filter1 = <span class="keyword">new</span> <a class="code" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> ();
    $filter1-&gt;setPattern ( $pattern )-&gt;setQuery ( $query );

    <span class="comment">// Optional combination of both can be used as well.</span>
    $filter2 = <span class="keyword">new</span> <a class="code" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> ( $pattern );
    $filter2-&gt;setQuery ( $query );

</pre></div><p> All three filters are <b>identical</b>.</p>
<h3><a class="anchor" id="examplesuserpattern"></a>
User Patterns</h3>
<p>A power of <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> is in declaration of user patterns.</p>
<p>Let's have an associative array (representing command line options or deserialized configuration file etc.) and we would like to find out whether it contains certain keys and what keys are redundant. Our pattern would have two outcomes:</p>
<ul>
<li>associative array containing only valid keys and corresponding values </li>
<li>and array of keys that ware filtered out</li>
</ul>
<p>We declare the class to represent this outcomes.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>ArrayKeyWhitelistResult {

    <span class="keyword">private</span> $_filtered;
    <span class="keyword">private</span> $_redundantKeys;

    <span class="comment">/*</span>
<span class="comment">     * Initialize whitelist</span>
<span class="comment">     *</span>
<span class="comment">     * @param     Array   $whitelist      Array of allowed keys.</span>
<span class="comment">     */</span>
    <span class="keyword">public</span> <span class="keyword">function</span> __construct(Array $filtered, Array $redundantKeys)
    {
        $this-&gt;_filtered = $filtered;
        $this-&gt;_redundantKeys = $redundantKeys;
    }

    <span class="comment">/*</span>
<span class="comment">     * Get filtering results</span>
<span class="comment">     *</span>
<span class="comment">     * @return  Array   Array containing keys and values from</span>
<span class="comment">     *                  query that DID match the whitelist pattern.</span>
<span class="comment">     */</span>
    <span class="keyword">public</span> <span class="keyword">function</span> getFiltered()
    {
        <span class="keywordflow">return</span> $this-&gt;_filtered;
    }

    <span class="comment">/*</span>
<span class="comment">     * Get filtered out</span>
<span class="comment">     *</span>
<span class="comment">     * @return  Array   Array containing keys from querty that DID NOT match</span>
<span class="comment">     *                  the whitelist pattern.</span>
<span class="comment">     */</span>
    <span class="keyword">public</span> <span class="keyword">function</span> getRedundantKeys()
    {
        <span class="keywordflow">return</span> $this-&gt;_redundantKeys;
    }
}
</pre></div><p> Next we create a pattern that performs filtering. It's <code><a class="el" href="interfaceMapFilter__PatternInterface_a95c938dfe1bb06693b7d628198c74d89.html#a95c938dfe1bb06693b7d628198c74d89" title="Parse the given query against the pattern.">MapFilter_PatternInterface::parse()</a></code> is supposed to return our result type.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">class </span>ArrayKeyWhitelistPattern <span class="keyword">implements</span> Mapfilter_PatternInterface {

    <span class="keyword">private</span> $_whitelist;

    <span class="comment">/*</span>
<span class="comment">     * Initialize whitelist</span>
<span class="comment">     *</span>
<span class="comment">     * @param     Array   $whitelist      Array of allowed keys.</span>
<span class="comment">     */</span>
    <span class="keyword">public</span> <span class="keyword">function</span> __construct(Array $whitelist)
    {
        $this-&gt;_whitelist = array_unique($whitelist);
    }

    <span class="comment">/*</span>
<span class="comment">     * Perform a filtering</span>
<span class="comment">     *</span>
<span class="comment">     * @param     Array   $query  A query to filter.</span>
<span class="comment">     * @return    ArrayKeyWhitelistResult</span>
<span class="comment">     */</span>
    <span class="keyword">public</span> <span class="keyword">function</span> parse($query)
    {

        <span class="keywordflow">if</span> ( !is_array($query) &amp;&amp; !( $query instanceof ArrayAccess ) ) {

          <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classMapFilter__InvalidStructureException.html" title="Class to handle invalid structure exception.">MapFilter_InvalidStructureException</a>;
        }

        $filtered = $redundantKeys = Array();
        <span class="keywordflow">foreach</span> ($query as $keyCandidate =&gt; $valueCandidate) {

            <span class="keywordflow">if</span>(in_array($keyCandidate, $this-&gt;_whitelist)) {

                $filtered[ $keyCandidate ] = $valueCandidate;
            } <span class="keywordflow">else</span> {

                $redundantKeys[] = $keyCandidate;
            }
        }

        <span class="keywordflow">return</span> <span class="keyword">new</span> ArrayKeyWhitelistResult($filtered, $redundantKeys);
    }
}
</pre></div><p> Using of the pattern is straightforward. Pattern is initialized with allowed keys, then injected to <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> along with the query. After that the filter is ready to fetch the results.</p>
<div class="fragment"><pre class="fragment">    <span class="comment">// Allowed options</span>
    $pattern = <span class="keyword">new</span> ArrayKeyWhitelistPattern (
        Array ( <span class="stringliteral">&#39;-v&#39;</span>, <span class="stringliteral">&#39;-h&#39;</span>, <span class="stringliteral">&#39;-o&#39;</span> )
    );

    $filter = <span class="keyword">new</span> <a class="code" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> ( $pattern, $query );

    $valid = $filter-&gt;fetchResult ()-&gt;getFiltered ();
    $redundant = $filter-&gt;fetchResult ()-&gt;getRedundantKeys ();

</pre></div><p> <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> will call the <code>ArrayKeyWhitelistPattern::parse()</code> method when we ask for the results for the first time. Even if we call <code><a class="el" href="classMapFilter_adc683e17988ab8f300062dd060b42fad.html#adc683e17988ab8f300062dd060b42fad" title="Get full filtering results.">MapFilter::fetchResult()</a></code> several times (as we did in the last example), <code><a class="el" href="interfaceMapFilter__PatternInterface_a95c938dfe1bb06693b7d628198c74d89.html#a95c938dfe1bb06693b7d628198c74d89" title="Parse the given query against the pattern.">MapFilter_PatternInterface::parse()</a></code> is guaranteed not to be called more than once.</p>
<h3><a class="anchor" id="examplesfilterreuse"></a>
Reuse of filter instance</h3>
<p>Instance of <a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> can be easily reused setting new pattern or query (or perhaps both) using setter methods. This could be useful in case we would like to filter the same query using different filters or more likely use the same filter with different user queries. In that case <code><a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a></code> calls <code><a class="el" href="interfaceMapFilter__PatternInterface_a95c938dfe1bb06693b7d628198c74d89.html#a95c938dfe1bb06693b7d628198c74d89" title="Parse the given query against the pattern.">MapFilter_PatternInterface::parse()</a></code> for every unique configuration.</p>
<div class="fragment"><pre class="fragment">
    <span class="comment">// Initial pattern configuration</span>
    $filter = <span class="keyword">new</span> <a class="code" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> ( $pattern, $query );

    <span class="comment">// Parsing is done here</span>
    $newResult = $filter-&gt;fetchResult ();

    <span class="comment">// Here we parse again since we have reset the query</span>
    $newQueryResult = $filter-&gt;setQuery ( $query )-&gt;fetchResult ();

    <span class="comment">// Here we parse again since we have reset the pattern</span>
    $newPatternResult = $filter-&gt;setPattern ( $pattern )-&gt;fetchResult ();

    <span class="comment">// No needed to parse the same query using the same pattern</span>
    <span class="comment">// $newPatternResult === $sameResult</span>
    $sameResult = $filter-&gt;fetchResult ();

</pre></div> <dl class="section see"><dt>See also:</dt><dd><a class="el" href="classMapFilter.html" title="Class to provide generic filter interface.">MapFilter</a> </dd>
<dd>
<a class="el" href="interfaceMapFilter__PatternInterface.html" title="MapFilter_Pattern Interface.">MapFilter_PatternInterface</a> </dd></dl>
</div></div><!-- contents -->
      <pre class="footer">$ git clone git://github.com/olivergondza/MapFilter</pre>
    </div>
    <address class="page_footer"><small>Generated for MapFilter by
    <a href="http://www.doxygen.org/index.html">doxygen</a>.</small></address>
  </body>
</html>
